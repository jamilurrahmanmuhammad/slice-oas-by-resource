# ADR-002: Python 3.11+ with pydantic-core for Type Safety

**Status**: Accepted

**Date**: 2025-12-17

**Context**

The slice-oas-by-resource tool requires a technology stack that supports:

- Cross-platform CLI execution (Linux, macOS, Windows)
- Strong type validation for OAS data structures
- JSON/YAML parsing with schema validation
- OpenAPI specification validation
- File-based I/O with no external network calls
- Developer productivity with good tooling and ecosystem
- Memory efficiency (<200MB for 1000+ endpoint files)
- Performance targets: <5s single extraction, <3 min for 100 endpoints

The choice of programming language, runtime version, and core dependencies affects:
- Development velocity and maintainability
- Testing framework selection (pytest)
- Deployment and packaging strategy
- Cross-platform compatibility guarantees
- Type safety and runtime validation

**Decision**

We adopt **Python 3.11+** as the implementation language with the following dependency stack:

### Core Dependencies

1. **pydantic (v2.5+)**
   - Data model validation and serialization
   - Type safety with runtime checking
   - OAS entity modeling (OASDocument, Resource, Reference, etc.)

2. **PyYAML (v5.4+)**
   - YAML parsing (most OAS files use YAML format)
   - JSON parsing (built-in Python json module for JSON files)

3. **openapi-spec-validator (v0.7+)**
   - Final output validation (Phase 7 of validation pipeline)
   - OAS 3.0.x and 3.1.x schema compliance checking

4. **jsonschema (v4.20+)**
   - Schema validation for component checking
   - Referenced by openapi-spec-validator

### Testing Framework

- **pytest (v7.4+)**: Unit and integration testing
- Fixtures for sample OAS 3.0.x/3.1.x specifications
- Test coverage for circular references and edge cases

### Python Version Requirements

- **Minimum**: Python 3.11
- **Rationale**:
  - Performance improvements in 3.11+ (faster runtime, better memory usage)
  - Enhanced error messages for better developer experience
  - Pattern matching (structural pattern matching) for OAS parsing
  - Type hint improvements (Self type, TypedDict improvements)

**Consequences**

### Positive

- **Rich Ecosystem**: Extensive libraries for YAML/JSON parsing, validation, and CLI tools
- **Type Safety**: Pydantic v2 provides runtime validation with minimal performance overhead
- **Developer Productivity**: Python's expressiveness reduces code volume; excellent tooling (mypy, black, ruff)
- **Testing Maturity**: pytest ecosystem is battle-tested with extensive plugin support
- **Cross-Platform**: Python runs natively on all target platforms with consistent behavior
- **Memory Efficiency**: Pydantic v2 uses Rust-based core (pydantic-core) for performance
- **Community Support**: Large community, extensive documentation, active maintenance for all dependencies

### Negative

- **Runtime Performance**: Python is slower than compiled languages (Go, Rust) for CPU-intensive operations
  - Acceptable: Performance targets (<5s, <3 min) are achievable with Python
- **Packaging Complexity**: Distributing Python applications requires consideration of virtual environments or bundling
  - Mitigation: Use pyproject.toml with clear dependencies; consider PyInstaller for standalone executables
- **Dependency Management**: Python dependency resolution can be fragile
  - Mitigation: Pin versions in pyproject.toml; use uv or pip-tools for lockfiles
- **GIL Limitations**: Global Interpreter Lock prevents true parallelism
  - Acceptable: Tool is single-threaded by design; batch processing is sequential

### Risks

- **Dependency Security**: Third-party libraries may have vulnerabilities
  - Mitigation: Regular dependency audits; use dependabot; minimal dependency tree
- **Version Compatibility**: Python 3.11+ requirement may exclude users on older systems
  - Mitigation: Clear documentation of minimum version; provide installation guidance
- **Breaking Changes**: Pydantic v2 has breaking changes from v1
  - Mitigation: Start with v2 from beginning; avoid migration issues

**Alternatives Considered**

### Alternative 1: Go
- **Pros**:
  - Excellent performance (5-10x faster than Python)
  - Static binary compilation (easy distribution)
  - Strong standard library for JSON/YAML
  - Excellent concurrency primitives
- **Cons**:
  - Less mature OpenAPI validation libraries
  - More verbose code (increased development time)
  - Smaller ecosystem for schema validation
  - Steeper learning curve for contributors
- **Rejected**: Development velocity and ecosystem maturity prioritized over raw performance; Python meets performance targets

### Alternative 2: Rust
- **Pros**:
  - Maximum performance and memory safety
  - Zero-cost abstractions
  - Growing ecosystem (serde for serialization)
  - Strong type system
- **Cons**:
  - Immature OpenAPI ecosystem (limited validation libraries)
  - Significant development time overhead
  - Steep learning curve for most contributors
  - Error handling verbosity
- **Rejected**: Ecosystem gaps and development complexity outweigh performance benefits; premature optimization

### Alternative 3: Node.js + TypeScript
- **Pros**:
  - Strong OpenAPI ecosystem (swagger-parser, openapi-validator)
  - Excellent JSON/YAML handling
  - TypeScript provides static typing
  - Large community
- **Cons**:
  - npm dependency hell (node_modules complexity)
  - Runtime type validation requires additional libraries (zod, io-ts)
  - Async-by-default adds complexity for synchronous CLI tool
  - Node.js runtime dependency larger than Python
- **Rejected**: Python provides better balance of ecosystem maturity, type safety (Pydantic), and simplicity for CLI use case

### Alternative 4: Custom Parser without pydantic
- **Pros**:
  - Minimal dependencies
  - Full control over validation logic
- **Cons**:
  - Reinventing the wheel (schema validation is complex)
  - Higher maintenance burden
  - Error-prone manual validation
  - Slower development
- **Rejected**: Pydantic is battle-tested and provides exactly what we need; custom validation is unnecessary risk

**References**

- [Specification](/home/jamil/repos/slice-oas-by-resource/specs/001-slice-oas-by-resource/spec.md)
- [Implementation Plan](/home/jamil/repos/slice-oas-by-resource/specs/001-slice-oas-by-resource/plan.md)
- [Research: OpenAPI Parsing Libraries](/home/jamil/repos/slice-oas-by-resource/specs/001-slice-oas-by-resource/research.md#research-task-1-openapi-parsing-libraries-for-python)
- Technical Context: plan.md lines 14-33
